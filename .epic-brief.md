# Implementation Brief: Epic 77A — Shared Dashboard SVG Components

## Scope
Frontend

## Tasks

### Task 77.1 — Create KpiCard component
**File**: `frontend/components/dashboard/kpi-card.tsx`

Props per Section 9.9.1:
```typescript
interface KpiCardProps {
  label: string;
  value: string | number;
  changePercent?: number | null;
  changeDirection?: "positive" | "negative" | "neutral";
  trend?: number[] | null;
  href?: string | null;
  emptyState?: string | null;
}
```

Visual: Shadcn Card with olive border. Large value (`text-2xl font-bold`), small label (`text-sm text-muted-foreground`). Change indicator: green up arrow for positive, red down arrow for negative. SparklineChart integration (renders inline if trend provided). If `href` set, wrap in `Link`. If `emptyState` set and value is null/zero, show empty state text. `"use client"` if href uses Link.

Pattern: follow `frontend/components/ui/card.tsx` for card styling.

**Acceptance criteria**:
- Renders label above value
- Shows green up arrow and percent for positive change
- Shows red down arrow and percent for negative change
- Renders SparklineChart when trend array provided
- Wraps entire card in Next.js Link when href provided
- Shows emptyState text instead of value when emptyState is set and value is null/0

---

### Task 77.2 — Create HealthBadge component
**File**: `frontend/components/dashboard/health-badge.tsx`

Props per Section 9.9.2:
```typescript
interface HealthBadgeProps {
  status: "HEALTHY" | "AT_RISK" | "CRITICAL" | "UNKNOWN";
  reasons?: string[] | null;
  size?: "sm" | "md" | "lg";
}
```

Visual:
- `sm`: Colored dot only (8px)
- `md`: Dot + text label ("Healthy", "At Risk", "Critical", "Unknown")
- `lg`: Dot + text label + reasons list below

Colors: HEALTHY=green-500, AT_RISK=amber-500, CRITICAL=red-500, UNKNOWN=gray-400 (note: use `gray-400` not `olive-400` for UNKNOWN per spec).

Tooltip on sm/md sizes showing reasons (use a simple `title` attribute or a custom tooltip div since there is no Shadcn Tooltip component installed yet -- do NOT install a new Shadcn component). On `lg` size, reasons are displayed inline below the label as small muted text.

Pattern: follow `frontend/components/ui/badge.tsx` for styling conventions.

**Acceptance criteria**:
- `sm` renders only a colored dot (8px)
- `md` renders dot + status text label
- `lg` renders dot + status text + reasons list
- Colors match the health status mapping
- Tooltip/title on sm/md shows reasons when provided

---

### Task 77.3 — Create MiniProgressRing component
**File**: `frontend/components/dashboard/mini-progress-ring.tsx`

Props per Section 9.9.3:
```typescript
interface MiniProgressRingProps {
  value: number; // 0-100
  size?: number; // px, default 32
  color?: string; // auto if omitted
}
```

Pure SVG circle with `stroke-dasharray` and `stroke-dashoffset`. Background circle in `muted` (use CSS variable or a neutral olive shade), foreground arc in computed color. Auto-color: value > 66 = green-500, > 33 = amber-500, <= 33 = red-500. Center text (showing value as integer percent) if `size >= 40`. No external library.

**Acceptance criteria**:
- Renders an SVG circular progress indicator
- Background circle visible behind foreground arc
- Arc length corresponds to value (0 = no arc, 100 = full circle)
- Auto-color: green > 66, amber > 33, red <= 33
- Shows percentage text in center when size >= 40
- Hides center text when size < 40

---

### Task 77.4 — Create SparklineChart component
**File**: `frontend/components/dashboard/sparkline-chart.tsx`

Props per Section 9.9.4:
```typescript
interface SparklineChartProps {
  data: number[];
  width?: number;  // default 80
  height?: number; // default 24
  color?: string;  // default "currentColor"
}
```

Pure SVG polyline. Normalize data to fill height. Subtle gradient fill below line. No axes, labels, grid. No external library. See ADR-046.

**Acceptance criteria**:
- Renders an SVG polyline from data points
- Data is normalized to fill available height
- Has a subtle gradient fill below the line
- Handles empty data array gracefully (renders empty SVG or nothing)
- Uses `currentColor` as default color
- No axes, labels, or grid lines

---

### Task 77.5 — Add tests for KpiCard and HealthBadge
**Files**:
- `frontend/__tests__/dashboard/kpi-card.test.tsx` (~4 tests)
- `frontend/__tests__/dashboard/health-badge.test.tsx` (~4 tests)

KpiCard tests:
1. Renders value and label
2. Renders change indicator (green up arrow for positive)
3. Renders empty state when value is null
4. Renders as link when href provided

HealthBadge tests:
1. Renders green dot for HEALTHY
2. Renders amber for AT_RISK with text at md size
3. Renders reasons at lg size
4. Shows tooltip/title on sm size

Pattern: follow `frontend/__tests__/` existing test files. Import `cleanup` from `@testing-library/react` and call in `afterEach`.

---

### Task 77.6 — Add tests for MiniProgressRing and SparklineChart
**Files**:
- `frontend/__tests__/dashboard/mini-progress-ring.test.tsx` (~2 tests)
- `frontend/__tests__/dashboard/sparkline-chart.test.tsx` (~2 tests)

MiniProgressRing tests:
1. Renders SVG at boundary values (0, 50, 100)
2. Auto-color applied correctly (green for >66, amber for >33, red for <=33)

SparklineChart tests:
1. Renders SVG polyline with data
2. Handles empty data array

---

## File Plan

### Create
- `frontend/components/dashboard/kpi-card.tsx` — KPI card with value, label, change indicator, sparkline, link
- `frontend/components/dashboard/health-badge.tsx` — Health status badge with dot, label, reasons
- `frontend/components/dashboard/mini-progress-ring.tsx` — SVG circular progress indicator
- `frontend/components/dashboard/sparkline-chart.tsx` — SVG sparkline chart
- `frontend/__tests__/dashboard/kpi-card.test.tsx` — KpiCard component tests
- `frontend/__tests__/dashboard/health-badge.test.tsx` — HealthBadge component tests
- `frontend/__tests__/dashboard/mini-progress-ring.test.tsx` — MiniProgressRing component tests
- `frontend/__tests__/dashboard/sparkline-chart.test.tsx` — SparklineChart component tests

### Modify
None expected -- pure new components.

---

## Reference Patterns

### Card Component (from `frontend/components/ui/card.tsx`)
```tsx
import * as React from "react";

import { cn } from "@/lib/utils";

function Card({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card"
      className={cn(
        "bg-card text-card-foreground flex flex-col gap-6 rounded-lg border border-olive-200 py-6 dark:border-olive-800",
        className
      )}
      {...props}
    />
  );
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
        className
      )}
      {...props}
    />
  );
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-title"
      className={cn("leading-none font-semibold", className)}
      {...props}
    />
  );
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn("col-start-2 row-span-2 row-start-1 self-start justify-self-end", className)}
      {...props}
    />
  );
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="card-content" className={cn("px-6", className)} {...props} />;
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-footer"
      className={cn("flex items-center px-6 [.border-t]:pt-6", className)}
      {...props}
    />
  );
}

export { Card, CardHeader, CardFooter, CardTitle, CardAction, CardDescription, CardContent };
```

### Badge Component (from `frontend/components/ui/badge.tsx`)
```tsx
import * as React from "react";
import { cva, type VariantProps } from "class-variance-authority";
import { Slot } from "radix-ui";

import { cn } from "@/lib/utils";

const badgeVariants = cva(
  "inline-flex items-center justify-center rounded-full border border-transparent px-2.5 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",
  {
    variants: {
      variant: {
        // Semantic role variants
        lead: "bg-indigo-100 text-indigo-700 dark:bg-indigo-900 dark:text-indigo-300",
        member: "bg-olive-100 text-olive-700 dark:bg-olive-800 dark:text-olive-300",
        owner: "bg-amber-100 text-amber-700 dark:bg-amber-900 dark:text-amber-300",
        admin: "bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300",
        // Plan variants
        starter: "bg-olive-100 text-olive-700 dark:bg-olive-800 dark:text-olive-300",
        pro: "bg-indigo-100 text-indigo-700 dark:bg-indigo-900 dark:text-indigo-300",
        // Status variants
        success: "bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",
        warning: "bg-amber-100 text-amber-700 dark:bg-amber-900 dark:text-amber-300",
        destructive: "bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300",
        // Generic
        neutral: "bg-olive-100 text-olive-600 dark:bg-olive-800 dark:text-olive-400",
        outline:
          "border-olive-200 text-olive-700 bg-transparent dark:border-olive-700 dark:text-olive-300",
        // Backward-compatible aliases
        default: "bg-olive-200 text-olive-800 dark:bg-olive-800 dark:text-olive-200",
        secondary: "bg-olive-100 text-olive-600 dark:bg-olive-800 dark:text-olive-400",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
);

function Badge({
  className,
  variant = "default",
  asChild = false,
  ...props
}: React.ComponentProps<"span"> & VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot.Root : "span";

  return (
    <Comp
      data-slot="badge"
      data-variant={variant}
      className={cn(badgeVariants({ variant }), className)}
      {...props}
    />
  );
}

export { Badge, badgeVariants };
```

### Status Dot Component (from `frontend/components/projects/budget-status-dot.tsx`)
```tsx
import { cn } from "@/lib/utils";
import type { BudgetStatus } from "@/lib/types";

const BUDGET_DOT_COLORS: Record<BudgetStatus, string> = {
  ON_TRACK: "bg-green-500",
  AT_RISK: "bg-amber-500",
  OVER_BUDGET: "bg-red-500",
};

const BUDGET_DOT_LABELS: Record<BudgetStatus, string> = {
  ON_TRACK: "On track",
  AT_RISK: "At risk",
  OVER_BUDGET: "Over budget",
};

export function BudgetStatusDot({ status }: { status: BudgetStatus }) {
  return (
    <span
      className={cn("inline-block size-2 rounded-full", BUDGET_DOT_COLORS[status])}
      title={BUDGET_DOT_LABELS[status]}
      aria-label={`Budget: ${BUDGET_DOT_LABELS[status]}`}
    />
  );
}
```

### cn() Utility (from `frontend/lib/utils.ts`)
```tsx
import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
```

### Test Pattern — Simple Component (from `frontend/__tests__/project-budget-indicator.test.tsx`)
```tsx
import { describe, it, expect, afterEach } from "vitest";
import { cleanup, render, screen } from "@testing-library/react";
import { BudgetStatusDot } from "@/components/projects/budget-status-dot";

describe("BudgetStatusDot", () => {
  afterEach(() => {
    cleanup();
  });

  it("renders correct indicator for each budget status", () => {
    const { unmount: u1 } = render(<BudgetStatusDot status="ON_TRACK" />);
    expect(screen.getByLabelText("Budget: On track")).toBeInTheDocument();
    u1();

    const { unmount: u2 } = render(<BudgetStatusDot status="AT_RISK" />);
    expect(screen.getByLabelText("Budget: At risk")).toBeInTheDocument();
    u2();

    render(<BudgetStatusDot status="OVER_BUDGET" />);
    expect(screen.getByLabelText("Budget: Over budget")).toBeInTheDocument();
  });

  it("renders as a small dot with the correct color class", () => {
    render(<BudgetStatusDot status="AT_RISK" />);
    const dot = screen.getByLabelText("Budget: At risk");
    expect(dot.className).toContain("bg-amber-500");
    expect(dot.className).toContain("size-2");
    expect(dot.className).toContain("rounded-full");
  });
});
```

### Test Pattern — Client Component with Mocks (from `frontend/__tests__/activity/activity-feed.test.tsx`)
```tsx
import { describe, it, expect, vi, beforeEach, afterEach } from "vitest";
import { cleanup, render, screen, waitFor } from "@testing-library/react";
import userEvent from "@testing-library/user-event";
import { ActivityItem } from "@/components/activity/activity-item";
import { ActivityFeedClient } from "@/components/activity/activity-feed-client";
import type { ActivityItem as ActivityItemType } from "@/lib/actions/activity";

const mockLoadMoreActivity = vi.fn();

vi.mock(
  "@/app/(app)/org/[slug]/projects/[id]/activity-actions",
  () => ({
    loadMoreActivity: (...args: unknown[]) => mockLoadMoreActivity(...args),
  })
);

function makeActivityItem(
  overrides: Partial<ActivityItemType> = {}
): ActivityItemType {
  return {
    id: "a1",
    message: "Alice created task Fix login bug",
    actorName: "Alice Johnson",
    actorAvatarUrl: null,
    entityType: "task",
    entityId: "t1",
    entityName: "Fix login bug",
    eventType: "task.created",
    occurredAt: "2026-02-12T14:30:00Z",
    ...overrides,
  };
}

describe("ActivityItem", () => {
  afterEach(() => {
    cleanup();
  });

  it("renders activity item with avatar initials, message, and timestamp", () => {
    render(<ActivityItem item={makeActivityItem()} />);

    expect(screen.getByText("AJ")).toBeInTheDocument();
    expect(
      screen.getByText("Alice created task Fix login bug")
    ).toBeInTheDocument();
  });

  it("renders avatar image when actorAvatarUrl is provided", () => {
    render(
      <ActivityItem
        item={makeActivityItem({
          actorAvatarUrl: "https://example.com/avatar.jpg",
        })}
      />
    );

    const img = screen.getByAltText("Alice Johnson");
    expect(img).toBeInTheDocument();
    expect(img).toHaveAttribute("src", "https://example.com/avatar.jpg");
  });
});

describe("ActivityFeedClient", () => {
  beforeEach(() => {
    vi.clearAllMocks();
  });

  afterEach(() => {
    cleanup();
  });

  it("shows empty state when no activity items", () => {
    render(
      <ActivityFeedClient
        projectId="p1"
        initialItems={[]}
        initialTotalPages={0}
      />
    );

    expect(screen.getByText("No activity yet")).toBeInTheDocument();
  });

  it("renders activity items and filter chips", () => {
    const items = [
      makeActivityItem({ id: "a1", message: "Alice created task Fix bug" }),
      makeActivityItem({
        id: "a2",
        message: "Bob uploaded document Spec.pdf",
        entityType: "document",
      }),
    ];

    render(
      <ActivityFeedClient
        projectId="p1"
        initialItems={items}
        initialTotalPages={1}
      />
    );

    expect(
      screen.getByText("Alice created task Fix bug")
    ).toBeInTheDocument();
    expect(
      screen.getByText("Bob uploaded document Spec.pdf")
    ).toBeInTheDocument();

    // Filter chips are rendered
    expect(screen.getByText("All")).toBeInTheDocument();
    expect(screen.getByText("Tasks")).toBeInTheDocument();
    expect(screen.getByText("Documents")).toBeInTheDocument();
    expect(screen.getByText("Comments")).toBeInTheDocument();
    expect(screen.getByText("Members")).toBeInTheDocument();
    expect(screen.getByText("Time")).toBeInTheDocument();
  });

  it("filters activity by entity type when filter chip is clicked", async () => {
    const user = userEvent.setup();
    const taskItem = makeActivityItem({
      id: "a1",
      message: "Alice created task Fix bug",
      entityType: "task",
    });

    mockLoadMoreActivity.mockResolvedValue({
      content: [taskItem],
      totalElements: 1,
      totalPages: 1,
      size: 20,
      number: 0,
    });

    render(
      <ActivityFeedClient
        projectId="p1"
        initialItems={[
          taskItem,
          makeActivityItem({
            id: "a2",
            message: "Bob added comment",
            entityType: "comment",
          }),
        ]}
        initialTotalPages={1}
      />
    );

    await user.click(screen.getByText("Tasks"));

    await waitFor(() => {
      expect(mockLoadMoreActivity).toHaveBeenCalledWith("p1", "TASK", 0);
    });
  });
});
```

### Test Pattern — Mocking next/navigation (from `frontend/__tests__/notifications/notification-bell.test.tsx`)
```tsx
// Mock next/navigation
vi.mock("next/navigation", () => ({
  useRouter: () => ({
    push: vi.fn(),
    replace: vi.fn(),
    refresh: vi.fn(),
    back: vi.fn(),
    forward: vi.fn(),
    prefetch: vi.fn(),
  }),
}));
```

### Vitest Config (from `frontend/vitest.config.mts`)
```ts
import { defineConfig } from "vitest/config";
import path from "path";

export default defineConfig({
  test: {
    environment: "happy-dom",
    setupFiles: ["./vitest.setup.ts"],
    coverage: {
      provider: "v8",
      reporter: ["text", "html", "json"],
      include: ["app/**/*.{ts,tsx}", "components/**/*.{ts,tsx}", "lib/**/*.ts"],
      exclude: ["**/*.test.{ts,tsx}", "**/*.spec.{ts,tsx}", "components/ui/**"],
    },
  },
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "."),
    },
  },
});
```

### Vitest Setup (from `frontend/vitest.setup.ts`)
```ts
import "@testing-library/jest-dom/vitest";
```

### Global CSS / Design Tokens (from `frontend/app/globals.css`)
```css
@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

@theme inline {
  /* Semantic color mappings */
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);

  /* Chart colors */
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);

  /* Sidebar semantic colors */
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);

  /* Olive color scale (OKLCH, hue ~107) */
  --color-olive-50: oklch(98.8% 0.003 106.5);
  --color-olive-100: oklch(96.6% 0.005 106.5);
  --color-olive-200: oklch(93% 0.007 106.5);
  --color-olive-300: oklch(88% 0.011 106.6);
  --color-olive-400: oklch(73.7% 0.021 106.9);
  --color-olive-500: oklch(58% 0.031 107.3);
  --color-olive-600: oklch(46.6% 0.025 107.3);
  --color-olive-700: oklch(39.4% 0.023 107.4);
  --color-olive-800: oklch(28.6% 0.016 107.4);
  --color-olive-900: oklch(22.8% 0.013 107.4);
  --color-olive-950: oklch(15.3% 0.006 107.1);

  /* Indigo accent */
  --color-indigo-500: oklch(58.5% 0.233 277.1);
  --color-indigo-600: oklch(51.1% 0.262 276.9);

  /* Fonts */
  --font-sans: var(--font-inter);
  --font-mono: var(--font-geist-mono);
  --font-display: var(--font-instrument-serif);

  /* Radius */
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --radius-2xl: calc(var(--radius) + 8px);
  --radius-3xl: calc(var(--radius) + 12px);
  --radius-4xl: calc(var(--radius) + 16px);
}

:root {
  --radius: 0.5rem;

  /* Olive raw scale (for semantic token references) */
  --olive-50: oklch(98.8% 0.003 106.5);
  --olive-100: oklch(96.6% 0.005 106.5);
  --olive-200: oklch(93% 0.007 106.5);
  --olive-300: oklch(88% 0.011 106.6);
  --olive-400: oklch(73.7% 0.021 106.9);
  --olive-500: oklch(58% 0.031 107.3);
  --olive-600: oklch(46.6% 0.025 107.3);
  --olive-700: oklch(39.4% 0.023 107.4);
  --olive-800: oklch(28.6% 0.016 107.4);
  --olive-900: oklch(22.8% 0.013 107.4);
  --olive-950: oklch(15.3% 0.006 107.1);

  /* Indigo accent */
  --indigo-500: oklch(58.5% 0.233 277.1);
  --indigo-600: oklch(51.1% 0.262 276.9);

  /* Semantic tokens -- light mode */
  --background: var(--olive-50);
  --foreground: var(--olive-900);
  --card: oklch(100% 0 0);
  --card-foreground: var(--olive-900);
  --popover: oklch(100% 0 0);
  --popover-foreground: var(--olive-900);
  --primary: var(--olive-950);
  --primary-foreground: oklch(100% 0 0);
  --secondary: var(--olive-100);
  --secondary-foreground: var(--olive-900);
  --muted: var(--olive-100);
  --muted-foreground: var(--olive-600);
  --accent: var(--indigo-600);
  --accent-foreground: oklch(100% 0 0);
  --destructive: oklch(0.577 0.245 27.325);
  --border: var(--olive-200);
  --input: var(--olive-200);
  --ring: var(--olive-500);

  /* Chart colors */
  --chart-1: oklch(0.646 0.222 41.116);
  --chart-2: oklch(0.6 0.118 184.704);
  --chart-3: oklch(0.398 0.07 227.392);
  --chart-4: oklch(0.828 0.189 84.429);
  --chart-5: oklch(0.769 0.188 70.08);

  /* Sidebar -- dark in both modes */
  --sidebar: var(--olive-950);
  --sidebar-foreground: oklch(100% 0 0);
  --sidebar-primary: oklch(100% 0 0);
  --sidebar-primary-foreground: var(--olive-950);
  --sidebar-accent: oklch(100% 0 0 / 5%);
  --sidebar-accent-foreground: oklch(100% 0 0);
  --sidebar-border: oklch(100% 0 0 / 10%);
  --sidebar-ring: var(--indigo-500);
}

.dark {
  --background: var(--olive-950);
  --foreground: oklch(100% 0 0);
  --card: var(--olive-900);
  --card-foreground: oklch(100% 0 0);
  --popover: var(--olive-900);
  --popover-foreground: oklch(100% 0 0);
  --primary: oklch(100% 0 0);
  --primary-foreground: var(--olive-950);
  --secondary: var(--olive-800);
  --secondary-foreground: oklch(100% 0 0);
  --muted: var(--olive-900);
  --muted-foreground: var(--olive-400);
  --accent: var(--indigo-500);
  --accent-foreground: oklch(100% 0 0);
  --destructive: oklch(0.704 0.191 22.216);
  --border: var(--olive-800);
  --input: var(--olive-800);
  --ring: var(--olive-500);

  /* Chart colors */
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);

  /* Sidebar -- same dark treatment */
  --sidebar: var(--olive-950);
  --sidebar-foreground: oklch(100% 0 0);
  --sidebar-primary: oklch(100% 0 0);
  --sidebar-primary-foreground: var(--olive-950);
  --sidebar-accent: oklch(100% 0 0 / 5%);
  --sidebar-accent-foreground: oklch(100% 0 0);
  --sidebar-border: oklch(100% 0 0 / 10%);
  --sidebar-ring: var(--indigo-500);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}
```

---

## Conventions

### Key Conventions (from frontend/CLAUDE.md)

**Route Groups:**
- `(auth)/` -- Sign-in/sign-up pages using Clerk components
- `(app)/` -- Authenticated routes, wrapped with Clerk protection
- Landing page is at `app/page.tsx` (root level, no route group)
- All authenticated routes are org-scoped under `(app)/org/[slug]/`.

**Path Aliases:**
- `@/*` maps to project root (configured in `tsconfig.json`)
- Import as `@/components/ui/button`, `@/lib/utils`, `@/hooks/use-something`

**Component Conventions:**
- Prefer React Server Components (RSC) by default -- only add `"use client"` when needed
- Feature components go in `components/{feature}/` (e.g., `components/projects/`)
- Shared UI primitives in `components/ui/` -- these have been customized (see below)
- Custom reusable components outside `ui/` should follow Shadcn patterns (forwardRef, CVA variants, cn())

**Shadcn UI -- Customized Components:**
- **Button** -- Pill-shaped (`rounded-full`) primary/accent/soft/destructive variants. `soft` and `plain` variants added.
- **Badge** -- Semantic variants: `lead`, `member`, `owner`, `admin`, `starter`, `pro`, `success`, `warning`, `destructive`, `neutral`.
- **Card** -- Olive borders, no default shadow, hover elevation on interactive cards.
- **Input / Textarea** -- Olive border, `focus-visible:ring-olive-500` focus ring.
- **Dialog / AlertDialog** -- Warm `bg-olive-950/25` backdrop, `rounded-xl`, Motion enter/exit animations.

**When adding new Shadcn components** via `npx shadcn@latest add <component>`, review the generated output and adjust to match the olive color scheme (replace any neutral/zinc/slate references with olive equivalents).

**Shadcn Config:**
- Style: **new-york**
- RSC-enabled: `true`
- Icon library: **lucide** (`lucide-react`)
- CSS variables: enabled

**Styling:**
- **Tailwind CSS v4** -- CSS-first config, no `tailwind.config.ts`
- PostCSS via `@tailwindcss/postcss` plugin
- CSS variables for theming in `app/globals.css`
- Use `cn()` from `@/lib/utils` to merge Tailwind classes (clsx + tailwind-merge)
- Olive color classes available: `bg-olive-50` through `bg-olive-950`, `text-olive-*`, `border-olive-*`
- Indigo accent classes: `bg-indigo-500`, `bg-indigo-600`, `text-indigo-*`

**TypeScript:**
- Strict mode enabled
- Module resolution: `bundler`
- Target: `ES2017`
- Use `interface` for component props, `type` for unions/utility types

**ESLint:**
- Flat config (`eslint.config.mjs`)
- Extends `eslint-config-next/core-web-vitals` and `eslint-config-next/typescript`
- Run with `pnpm run lint`

**Testing:**
- **Vitest** with `@testing-library/react` and `happy-dom`
- Config in `vitest.config.mts` -- needs `resolve.alias` for `@/*` path alias
- Test files: colocated (`*.test.tsx`) or in `__tests__/` directory
- Radix UI components leak DOM between tests -- always add `afterEach(() => cleanup())` in test files using Dialog/AlertDialog
- Use unique trigger text per test file to avoid "multiple elements found" errors

**Next.js 16 Patterns:**
- Params are Promises in layouts and pages:
  ```tsx
  export default async function Page({ params }: { params: Promise<{ slug: string }> }) {
    const { slug } = await params;
  }
  ```
- Radix UI imports use bundled `radix-ui` package (not `@radix-ui/react-*`)

### Anti-Patterns -- Never Do This (VERBATIM from frontend/CLAUDE.md)

- Never use `@radix-ui/react-*` packages -- use the unified `radix-ui` package instead
- Never put `"use client"` on a component unless it uses hooks, event handlers, or browser APIs
- Never call `auth()` in client components -- it's server-only
- Never access `params` without `await` -- Next.js 16 params are Promises
- Never skip `cssLayerName: "clerk"` on ClerkProvider -- breaks Tailwind v4
- Never use `npm` -- this project uses `pnpm`
- Never use neutral/zinc/slate/gray color classes -- use the olive scale instead
- Never import `motion` in server components -- it's client-only. Only import in `"use client"` files.

---

## Integration Points

### Component Directory
All new components go in `frontend/components/dashboard/`. This directory does not exist yet and must be created.

### Import Patterns
- Named exports (not default exports) for components -- follow the Card/Badge patterns above
- Import `cn` from `@/lib/utils` for class merging
- Import `Link` from `next/link` for navigation
- Lucide icons: `import { ArrowUp, ArrowDown } from "lucide-react"`

### "use client" Directive
- **KpiCard**: Needs `"use client"` because it may wrap content in a `Link` component. Actually, `Link` from `next/link` works in server components too. The KpiCard has NO hooks, event handlers, or browser APIs, so it should be a **server component** (no `"use client"` directive). Pass the `href` and render `Link` without needing client mode.
- **HealthBadge**: Pure presentational, no hooks. Server component -- no `"use client"`.
- **MiniProgressRing**: Pure SVG, no hooks. Server component -- no `"use client"`.
- **SparklineChart**: Pure SVG, no hooks. Server component -- no `"use client"`.

### No Tooltip Component Installed
The project does NOT have a Tooltip component in `frontend/components/ui/`. For the HealthBadge tooltip on sm/md sizes, use the native HTML `title` attribute on the wrapper element. Do NOT install a new Shadcn component for this slice -- keep it simple.

### Available Shadcn UI Components
The following are available in `frontend/components/ui/`:
`alert-dialog`, `avatar-circle`, `badge`, `button`, `card`, `command`, `dialog`, `dropdown-menu`, `input`, `label`, `popover`, `progress`, `separator`, `sheet`, `skeleton`, `switch`, `table`, `tabs`, `textarea`

### Color Mapping for Health Status
Use these Tailwind color classes consistently:
```
HEALTHY:  bg-green-500 / text-green-500
AT_RISK:  bg-amber-500 / text-amber-500
CRITICAL: bg-red-500 / text-red-500
UNKNOWN:  bg-gray-400 / text-gray-400
```
Note: The anti-pattern says "Never use neutral/zinc/slate/gray color classes -- use the olive scale instead." However, `gray-400` is specifically called out in the architecture spec for UNKNOWN status. Since this is a semantic color (representing "no data / unknown"), it is acceptable here and distinct from using gray for backgrounds or text. If this causes a lint issue, use `olive-400` as a fallback.

### SVG Implementation Notes (from ADR-046)
- SparklineChart: single SVG `<polyline>` element, ~15 lines of code. No Recharts.
- MiniProgressRing: SVG circle with `stroke-dasharray`/`stroke-dashoffset`. No Recharts.
- Both are pure presentational components with zero external dependencies.

---

## Build & Verify

All commands run from: `cd /Users/rakheendama/Projects/2026/worktree-epic-77A/frontend`

```bash
NODE_OPTIONS="" /opt/homebrew/bin/pnpm install > /dev/null 2>&1
NODE_OPTIONS="" /opt/homebrew/bin/pnpm run lint > /tmp/lint-epic-77A.log 2>&1; LINT_EXIT=$?; if [ $LINT_EXIT -ne 0 ]; then echo "LINT FAILED"; tail -20 /tmp/lint-epic-77A.log; fi
NODE_OPTIONS="" /opt/homebrew/bin/pnpm run build > /tmp/build-epic-77A.log 2>&1; BUILD_EXIT=$?; if [ $BUILD_EXIT -ne 0 ]; then echo "BUILD FAILED"; tail -30 /tmp/build-epic-77A.log; fi
NODE_OPTIONS="" /opt/homebrew/bin/pnpm test > /tmp/test-epic-77A.log 2>&1; TEST_EXIT=$?; if [ $TEST_EXIT -ne 0 ]; then echo "TESTS FAILED"; tail -30 /tmp/test-epic-77A.log; else echo "ALL TESTS PASSED"; tail -3 /tmp/test-epic-77A.log; fi
```

## Environment
- pnpm: `/opt/homebrew/bin/pnpm`
- `NODE_OPTIONS=""` needed before pnpm commands
- Working directory for all commands: `/Users/rakheendama/Projects/2026/worktree-epic-77A/frontend`
- Git branch: work in the worktree at `/Users/rakheendama/Projects/2026/worktree-epic-77A`
